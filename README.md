# Uniform Optimize starter for Next.js using NESI on Cloudflare Workers Example Project

This is a [Next.js](https://nextjs.org/) project bootstrapped with [`create-next-app`](https://github.com/vercel/next.js/tree/canary/packages/create-next-app) utilizing Uniform NESI (Not Edge Side Includes) components and a [Cloudflare Workers](https://workers.cloudflare.com/) serverless application.

During a Next.js export, NESI components will render all variants into the HTML wrapped in tags that contain personalization information for each variant and list options. The Next.js will build using Static Generation into the `out` directory. The Cloudflare Worker application is configured to use the `out` directory as it's site root and the contents of this directory are deployed to Cloudflare Workers KV.

When a request comes through the Cloudflare Worker, the file is retrieved from Workers KV and processed using the visitor intent scores on Edge. The markup generated by the NESI components is removed, leaving behind just the personalized components.

## Getting Started

### Configure environment variables

- Copy .env.example to .env
- Set Contentful variable values to match your CMS
- Configure your Uniform data source
- Copy wrangler.toml.example to wrangler.toml
- Populate `account_id` and `zone_id` with values from Cloudflare

### Install packages

```shell
npm i
# or
yarn
```

### Run the development server

```shell
npm run dev
# or
yarn dev
```

Open <http://localhost:8787> with your browser to see the result.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.
- [Cloudflare Workers Documenation](https://developers.cloudflare.com/workers/) - learn about building with Cloudflare Workers

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js/) - your feedback and contributions are welcome!
